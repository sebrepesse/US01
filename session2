"""
------------- FUNCTION EXPLANATIONS -------------
break  : stop the loop to the first iteration
split : it'll take any texts and make 2 blocks with it (before and after)
df : shortcut in order to access to the excel file (such pd for pandas)
loc[n] : locate the first line

------------- OBJECTIVES OF THE SESSIONS -------------
1- find the iso codes
2- put it inside the code
3-

"""

import pandas as pd
import requests as rq

df = pd.read_excel('Data-sheet-STUDENTS.xlsx',header=2,index_col=0)
#df['Country (according to CN Gov):']

iso_codes = {}    #create a table that will contain all the iso_codes of each countries

for index, name in df['Country (according to CN Gov):'].items():  #create the loop to only have the names of the countries
    if name in iso_codes:
        continue    #means that if the name already exists then it'll pass the step

    cleaned_name = name.split('(')[0].strip()    #remove the error of France (Not BRI) / Thailiand / USA...
    if cleaned_name == 'Thailiand':
        cleaned_name = 'Thailand'
    if cleaned_name == 'The United Arab Emirates':
        cleaned_name = 'United Arab Emirates'
        
    url = 'https://restcountries.eu/rest/v2/name/' + cleaned_name   #don't forget to change into cleaned_name
    r = rq.get(url)  #create the fonction request to obtain the isocodes
    if r.status_code == 200:
        data = r.json() #check the status code if 200 it's success
        country_code = data[0]['alpha3Code']   #enter inside the table and go to the first column and then to the parameter
        iso_codes[name] = country_code   #put the code inside the table
    else:
        print('ERROR',r.status_code,r.text)
        print(name)
        
 df['isocode'] = df['Country (according to CN Gov):'].apply(lambda x: iso_codes[x])
  df[['isocode','Country (according to CN Gov):']]
